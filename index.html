<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>wonderï½œè‡ªæˆ‘æå•èˆ‡æ•…äº‹å‰µä½œ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.1.1/wordcloud2.min.js"></script>
  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      background: #fefefc;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
      text-align: center;
    }

    .card {
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      padding: 2rem;
      max-width: 600px;
      font-size: 1.5rem;
      line-height: 1.8;
      margin-bottom: 1.5rem;
    }

    textarea {
      width: 100%;
      max-width: 600px;
      height: 140px;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 1rem;
      font-size: 1rem;
      resize: none;
      font-family: "Noto Sans TC", sans-serif;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-bottom: 1rem;
    }

    .button-group {
      margin-top: 1rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 1.5rem;
      background: #222;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #444;
    }

    .footer {
      margin-top: 2rem;
      font-size: 0.85rem;
      color: #aaa;
    }

    .history, #wordCloud {
      max-width: 600px;
      text-align: left;
      background: #f4f4f4;
      padding: 1rem;
      border-radius: 1rem;
      margin-top: 2rem;
      white-space: pre-wrap;
    }

    .history h3 {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .entry {
      margin-bottom: 1rem;
    }

    .entry strong {
      color: #444;
    }

    .mode-switch {
      margin-bottom: 1rem;
    }

    #wordCloudCanvas {
      width: 100%;
      height: 300px;
    }
  </style>
</head>
<body>

  <div class="mode-switch">
    <button onclick="switchMode('wonder')">ğŸ§  wonder æå•</button>
    <button onclick="switchMode('story')">âœï¸ æ•…äº‹é–‹é ­</button>
  </div>

  <div class="card" id="prompt">è¼‰å…¥ä¸­...</div>

  <textarea id="answer" placeholder="åœ¨é€™è£¡å¯«ä¸‹ä½ çš„æƒ³æ³•æˆ–æ•…äº‹..."></textarea>

  <div class="button-group">
    <button onclick="saveAndNext()">å„²å­˜ä¸¦ä¸‹ä¸€é¡Œ</button>
    <button onclick="clearAnswer()">æ¸…é™¤å›ç­”</button>
    <button onclick="toggleHistory()">æŸ¥çœ‹æ­·å²</button>
    <button onclick="generateWordCloud()">å­—è©é›²</button>
  </div>

  <div class="history" id="historyBox" style="display:none;"></div>

  <div class="history" id="wordCloud" style="display:none;">
    <h3>ğŸª„ å¸¸å‡ºç¾çš„å­—è©</h3>
    <canvas id="wordCloudCanvas"></canvas>
  </div>

  <div class="footer">wonderï½œç•¶ä¸‹æ¢ç´¢ãƒ»è‰ç¨¿è‡ªå‹•ä¿å­˜ä¸­</div>

  <script>
    const wonderQuestions = [
      "ä½ å‰›å‰›çœ¼ç›æ˜¯ä¸æ˜¯ä¸å°å¿ƒå°ä¸Šä»€éº¼äº†ï¼Ÿ",
      "ä½ ç¾åœ¨èº«ä¸Šæœ‰å“ªä¸€æ¨£æ±è¥¿æ˜¯åˆ¥äººé€çš„ï¼Ÿ",
      "å‰›å‰›ä½ æ˜¯ä¸æ˜¯çªç„¶æƒ³èµ·ä¸€ä»¶äº‹ï¼Œä½†åˆå¿˜äº†ï¼Ÿ",
      "ä½ æ‰‹æ©Ÿè£¡æœ€èˆŠçš„ä¸€å¼µç…§ç‰‡é‚„åœ¨å—ï¼Ÿ",
      "å¦‚æœå‰›å‰›æœ‰ä¸€éš»å‹•ç‰©ç¶“éä½ èº«é‚Šï¼Œä½ å¸Œæœ›æ˜¯å“ªä¸€ç¨®ï¼Ÿ",
      "ä½ ç¾åœ¨æœ€è¨å­è½åˆ°å“ªå¥è©±ï¼Ÿ",
      "ä½ æ˜¯ä¸æ˜¯æœ‰æ±è¥¿è—åœ¨å£è¢‹è£¡ï¼Œä½†ä½ è‡ªå·±ä¹Ÿå¿˜äº†ï¼Ÿ"
    ];

    const storyOpenings = [
      "ä»–æœ€å¾Œä¸€æ¬¡è¦‹åˆ°å¥¹ï¼Œæ˜¯åœ¨ä¸€å ´çªç„¶ä¸‹èµ·çš„é›¨ä¸­â€”â€”",
      "ç•¶é‚£é“é–€æ‰“é–‹çš„ç¬é–“ï¼Œä»–æ˜ç™½ä»Šå¤©ä¸æœƒæ˜¯æ™®é€šçš„ä¸€å¤©ã€‚",
      "å¥¹æ”¶åˆ°é‚£å°ä¿¡çš„æ™‚å€™ï¼Œçª—å¤–æ­£é£„è‘—ç²‰è‰²çš„é›ªã€‚",
      "è²“å’ªçªç„¶èªªè©±äº†ï¼Œè²éŸ³ä½ä½çš„åƒæŸå€‹ç†Ÿäººã€‚",
      "é‚£å°é›»æ¢¯çš„æ•¸å­—åœåœ¨äº†ä¸å­˜åœ¨çš„æ¨“å±¤ã€‚",
      "å‡Œæ™¨ä¸‰é»ï¼Œä¸€é€šæ²’é¡¯ç¤ºè™Ÿç¢¼çš„é›»è©±éŸ¿èµ·äº†ã€‚",
      "ä»–åœ¨èƒŒåŒ…è£¡ç™¼ç¾äº†ä¸€æœ¬ä¸å±¬æ–¼è‡ªå·±çš„æ—¥è¨˜ã€‚"
    ];

    let currentPrompt = "";
    let currentMode = "wonder";
    const answerBox = document.getElementById("answer");

    function switchMode(mode) {
      saveDraft();
      currentMode = mode;
      getPrompt();
      loadDraft();
      document.getElementById("historyBox").style.display = "none";
      document.getElementById("wordCloud").style.display = "none";
    }

    function getPrompt() {
      const source = currentMode === "wonder" ? wonderQuestions : storyOpenings;
      const p = source[Math.floor(Math.random() * source.length)];
      currentPrompt = p;
      document.getElementById("prompt").textContent = p;
    }

    function clearAnswer() {
      answerBox.value = "";
      saveDraft();
    }

    function saveAndNext() {
      const answer = answerBox.value.trim();
      if (answer !== "") {
        const key = currentMode + "-history";
        const saved = JSON.parse(localStorage.getItem(key) || "[]");
        saved.unshift({ prompt: currentPrompt, answer: answer, time: new Date().toLocaleString() });
        localStorage.setItem(key, JSON.stringify(saved));
      }
      clearAnswer();
      clearDraft();
      getPrompt();
    }

    function toggleHistory() {
      const box = document.getElementById("historyBox");
      const key = currentMode + "-history";
      const title = currentMode === "wonder" ? "ğŸ§  Wonder æ­·å²å›ç­”" : "âœï¸ æ•…äº‹å‰µä½œç´€éŒ„";
      const saved = JSON.parse(localStorage.getItem(key) || "[]");
      if (box.style.display === "block") {
        box.style.display = "none";
        return;
      }
      if (saved.length === 0) {
        box.innerHTML = `<h3>${title}</h3><div class='entry'>ï¼ˆå°šæœªå›ç­”ä»»ä½•å…§å®¹ï¼‰</div>`;
      } else {
        box.innerHTML = `<h3>${title}</h3>` + saved.map(entry =>
          `<div class="entry"><strong>${currentMode === "wonder" ? "Q" : "é–‹é ­"}ï¼š</strong>${entry.prompt}<br/><strong>ä½ å¯«ï¼š</strong>${entry.answer}<br/><span style="font-size:0.8rem;color:#888">ğŸ•’ ${entry.time}</span></div>`
        ).join("");
      }
      box.style.display = "block";
    }

    function saveDraft() {
      const draftKey = currentMode + "-draft";
      localStorage.setItem(draftKey, answerBox.value);
    }

    function loadDraft() {
      const draftKey = currentMode + "-draft";
      answerBox.value = localStorage.getItem(draftKey) || "";
    }

    function clearDraft() {
      const draftKey = currentMode + "-draft";
      localStorage.removeItem(draftKey);
    }

    // è‡ªå‹•å„²å­˜è‰ç¨¿
    setInterval(saveDraft, 2000);

    // å­—è©é›²åŠŸèƒ½
    function generateWordCloud() {
      const key = currentMode + "-history";
      const saved = JSON.parse(localStorage.getItem(key) || "[]");
      const text = saved.map(entry => entry.answer).join(" ");
      const words = text
        .replace(/[^\u4e00-\u9fa5a-zA-Z]/g, ' ')
        .split(/\s+/)
        .filter(word => word.length > 1 && !commonWords.includes(word));
      const freq = {};
      words.forEach(w => freq[w] = (freq[w] || 0) + 1);
      const list = Object.entries(freq).sort((a, b) => b[1] - a[1]);
      WordCloud(document.getElementById("wordCloudCanvas"), {
        list: list.slice(0, 50),
        gridSize: 8,
        weightFactor: 12,
        fontFamily: 'Noto Sans TC',
        color: 'random-dark',
        backgroundColor: '#f4f4f4'
      });
      document.getElementById("wordCloud").style.display = "block";
      document.getElementById("historyBox").style.display = "none";
    }

    // å¸¸è¦‹å­—è©ï¼ˆå¯æ“´å……ï¼‰
    const commonWords = ["çš„æ˜¯", "é€™å€‹", "é‚£å€‹", "ç„¶å¾Œ", "ç¾åœ¨", "å¯ä»¥", "å› ç‚º", "å°±æ˜¯", "æ²’æœ‰", "æœ‰é»", "ä¸€ä¸‹", "ä»€éº¼", "è‡ªå·±", "çœŸçš„", "ä¸æœƒ", "ä¸è¦", "ä¸è¦", "ä»Šå¤©"];

    // åˆå§‹è¼‰å…¥
    window.onload = () => {
      switchMode("wonder");
    };
  </script>
</body>
</html>
